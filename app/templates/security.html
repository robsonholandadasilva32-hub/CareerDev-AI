{% extends "dashboard_layout.html" %}

{% block dashboard_content %}
<div class="card security-panel">
    <h2>ğŸ” Central de SeguranÃ§a e PreferÃªncias</h2>

    {% if success or request.query_params.get('success') %}
    <div style="background: rgba(0, 255, 136, 0.2); color: #00ff88; padding: 10px; border-radius: 8px; margin-bottom: 20px;">
        ConfiguraÃ§Ãµes atualizadas com sucesso!
    </div>
    {% endif %}

    <!-- ACTIVE SESSIONS (NEW) -->
    <div class="setting-group" style="margin-bottom: 30px;">
        <h3>ğŸ“± SessÃµes Ativas</h3>
        <p style="color: #9ca3af; font-size: 0.9rem;">Dispositivos onde vocÃª estÃ¡ conectado atualmente.</p>

        <div style="background: rgba(0,0,0,0.3); border: 1px solid var(--accent-color); border-radius: 8px; overflow: hidden; margin-top: 15px;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: rgba(255,255,255,0.05); text-align: left;">
                        <th style="padding: 12px; color: var(--text-color);">Dispositivo / Navegador</th>
                        <th style="padding: 12px; color: var(--text-color);">IP</th>
                        <th style="padding: 12px; color: var(--text-color);">Ãšltimo Acesso</th>
                        <th style="padding: 12px; color: var(--text-color);">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in sessions %}
                    <tr style="border-top: 1px solid var(--accent-color);">
                        <td style="padding: 12px; color: #d1d5db;">
                            <div style="display: flex; align-items: center; gap: 8px;" title="{{ session.user_agent }}">
                                <span>ğŸ’»</span>
                                {{ session.user_agent[:40] }}{% if session.user_agent|length > 40 %}...{% endif %}
                            </div>
                        </td>
                        <td style="padding: 12px; color: #9ca3af;">{{ session.ip_address }}</td>
                        <td style="padding: 12px; color: #9ca3af;">
                            {{ session.last_active_at.strftime('%d/%m/%Y %H:%M') if session.last_active_at else 'Unknown' }}
                        </td>
                        <td style="padding: 12px;">
                            {% if session.id == current_sid %}
                            <span style="background: rgba(0, 255, 136, 0.1); color: #00ff88; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                                SessÃ£o Atual
                            </span>
                            {% else %}
                            <span style="color: #6b7280; font-size: 0.8rem;">Ativa</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" style="padding: 20px; text-align: center; color: #6b7280;">Nenhuma sessÃ£o ativa encontrada.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <form method="post" action="/dashboard/security/update" style="display: flex; flex-direction: column; gap: 20px;">

        <!-- Global Preferences -->
        <div class="setting-group" style="border-top: 1px solid #2d3748; padding-top: 20px; margin-top: 10px;">
            <h3>ğŸŒ PreferÃªncias Globais</h3>

            <label for="language">Idioma</label>
            <select name="language" id="language" style="width: 100%; padding: 10px; background: #0a1020; border: 1px solid #2d3748; border-radius: 6px; color: white; margin-top: 5px;">
                <option value="pt" {% if lang == 'pt' %}selected{% endif %}>ğŸ‡§ğŸ‡· PortuguÃªs (Brasil)</option>
                <option value="en" {% if lang == 'en' %}selected{% endif %}>ğŸ‡ºğŸ‡¸ English</option>
                <option value="es" {% if lang == 'es' %}selected{% endif %}>ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                <option value="fr" {% if lang == 'fr' %}selected{% endif %}>ğŸ‡«ğŸ‡· FranÃ§ais</option>
                <option value="de" {% if lang == 'de' %}selected{% endif %}>ğŸ‡©ğŸ‡ª Deutsch</option>
            </select>
        </div>

        <button type="submit" class="btn">Salvar AlteraÃ§Ãµes</button>
    </form>

    <!-- Danger Zone -->
    <div class="setting-group" style="border-top: 1px solid #ff0055; padding-top: 20px; margin-top: 30px;">
        <h3 style="color: #ff0055;">â˜ ï¸ Zona de Perigo</h3>
        <p style="color: #9ca3af; font-size: 0.9rem;">Essas aÃ§Ãµes sÃ£o irreversÃ­veis.</p>

        <form method="post" action="/dashboard/security/delete-account" onsubmit="return confirm('Tem certeza absoluta? Esta aÃ§Ã£o nÃ£o pode ser desfeita e todos os seus dados serÃ£o perdidos.');">
            <button type="submit" class="btn" style="background: rgba(255, 0, 85, 0.1); border: 1px solid #ff0055; color: #ff0055; width: auto; margin-top: 10px;">
                Excluir minha conta permanentemente
            </button>
        </form>
    </div>
</div>
{% endblock %}
