{% extends "base.html" %}

{% block content %}
<section>
  <h2>{{ t.verify_email_title or "Confirme seu e-mail" }}</h2>

  <p>{{ t.verify_email_text or "Digite o c贸digo enviado para seu e-mail." }}</p>

  {% if error %}
    <p style="color:#ff6b6b;">{{ error }}</p>
  {% endif %}

  <form method="post" action="/verify-email">
    <input type="hidden" name="user_id" value="{{ user_id }}">
    <input type="hidden" name="lang" value="{{ lang }}">

    <label for="code">{{ t.verify_code_label or "C贸digo" }}</label>
    <input id="code" name="code" required>

    <button type="submit" class="btn">
      {{ t.verify_button or "Confirmar" }}
    </button>
  </form>

  <form method="post" action="/resend-verification" style="margin-top: 20px; text-align: center;">
    <input type="hidden" name="user_id" value="{{ user_id }}">
    <input type="hidden" name="lang" value="{{ lang }}">
    <button id="resend-btn" type="submit" class="btn-outline" aria-label="{{ t.verify_email_resend_button or 'Reenviar C贸digo' }}">
      {{ t.verify_email_resend_button or "Reenviar C贸digo" }}
    </button>
  </form>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const resendBtn = document.getElementById('resend-btn');
      if (resendBtn) {
        const cooldownTime = 30; // seconds
        let timeLeft = cooldownTime;

        // Disable immediately
        resendBtn.disabled = true;
        resendBtn.style.opacity = '0.5';
        resendBtn.style.cursor = 'not-allowed';
        const originalText = resendBtn.innerText;

        resendBtn.innerText = originalText + ' (' + timeLeft + 's)';

        const timer = setInterval(function() {
          timeLeft--;
          resendBtn.innerText = originalText + ' (' + timeLeft + 's)';

          if (timeLeft <= 0) {
            clearInterval(timer);
            resendBtn.disabled = false;
            resendBtn.innerText = originalText;
            resendBtn.style.opacity = '1';
            resendBtn.style.cursor = 'pointer';
          }
        }, 1000);
      }
    });
  </script>
</section>
{% endblock %}

