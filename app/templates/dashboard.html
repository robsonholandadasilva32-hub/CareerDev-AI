<script>
async function verifyRepo(taskId, keyword) {
    const btn = document.getElementById(`btn-${taskId}`);
    const status = document.getElementById(`status-${taskId}`);

    btn.disabled = true;
    btn.innerText = "SCANNING…";
    status.innerText = "";

    try {
        const res = await fetch("/api/verify/repo", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ language: keyword })
        });

        const data = await res.json();

        if (data.verified) {
            btn.innerText = "VERIFIED ✓";
            btn.style.background = "var(--neon-green)";
            status.innerText = "Code verified on GitHub.";
        } else {
            btn.innerText = "NOT FOUND";
            btn.style.background = "var(--alert)";
            status.innerText = "No compatible commits detected.";
            btn.disabled = false;
        }
    } catch (err) {
        btn.innerText = "ERROR";
        btn.style.background = "var(--alert)";
        status.innerText = "Verification failed.";
        btn.disabled = false;
    }
}
</script>
